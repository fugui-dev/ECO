# åŠ¨æ€è¡¥å¿ç®—åŠ›è®¡ç®—å®žçŽ°æ€»ç»“

## ðŸ“Š **éœ€æ±‚è¯´æ˜Ž**

å°†çŸ¿æœºè´­ä¹°æ—¶çš„å›ºå®šå€æ•°è¡¥å¿ç®—åŠ›æ”¹ä¸ºåŠ¨æ€è®¡ç®—ï¼š
- **æ–°è§„åˆ™**ï¼šè¡¥å¿ç®—åŠ› = åŽŸå§‹ç®—åŠ› Ã— 1.003^(n-1)
- **n** = çŸ¿æœºåˆ›å»ºæ—¶é—´åˆ°è´­ä¹°æ—¶é—´çš„å¤©æ•°
- **ç”Ÿæ•ˆæ—¶é—´**ï¼šä»Žç¬¬äºŒå¤©å¼€å§‹è¡¥å¿ï¼ˆn â‰¥ 2ï¼‰

## ðŸ”§ **ä¿®æ”¹å‰çš„é—®é¢˜**

### **åŽŸæœ‰å›ºå®šå€æ•°é€»è¾‘**
```java
// ä»Žç³»ç»Ÿé…ç½®èŽ·å–å›ºå®šå€æ•°
BigDecimal increase = new BigDecimal(increaseSystemConfig.getValue());
BigDecimal actualComputingPower = new BigDecimal(minerProject.getComputingPower()).multiply(increase);
```

**é—®é¢˜**ï¼š
- ä½¿ç”¨å›ºå®šçš„ç³»ç»Ÿé…ç½®å€æ•°
- ä¸è€ƒè™‘çŸ¿æœºåˆ›å»ºæ—¶é—´ä¸Žè´­ä¹°æ—¶é—´çš„é—´éš”
- æ— æ³•ä½“çŽ°æ—¶é—´ä»·å€¼è¡¥å¿

## âœ… **ä¿®æ”¹åŽçš„åŠ¨æ€è®¡ç®—é€»è¾‘**

### **æ ¸å¿ƒå®žçŽ°**

#### 1. ä¸»è®¡ç®—é€»è¾‘
```java
// è®¡ç®—åŠ¨æ€è¡¥å¿ç®—åŠ› - 1.003çš„n-1æ¬¡æ–¹ï¼Œnä¸ºçŸ¿æœºåˆ›å»ºæ—¶é—´åˆ°è´­ä¹°æ—¶é—´çš„å¤©æ•°
BigDecimal actualComputingPower = calculateDynamicCompensationPower(minerProject, purchaseMinerProject.getCreateTime());

if (actualComputingPower.compareTo(new BigDecimal(minerProject.getComputingPower())) > 0) {
    // è®¾ç½®è¡¥å¿ç®—åŠ›
    purchaseMinerProject.setActualComputingPower(actualComputingPower.toString());
    
    // è®¾ç½®åŠ é€Ÿåˆ°æœŸæ—¶é—´ï¼ˆç¬¬äºŒå¤©å¼€å§‹ç”Ÿæ•ˆï¼‰
    LocalDateTime effectiveDate = LocalDateTime.now().plusDays(1);
    Long effectiveTime = effectiveDate.atZone(ZoneId.systemDefault()).toInstant().toEpochMilli();
    purchaseMinerProject.setAccelerateExpireTime(effectiveTime);
} else {
    // å¦‚æžœæ²¡æœ‰è¡¥å¿ï¼Œä½¿ç”¨åŽŸå§‹ç®—åŠ›
    purchaseMinerProject.setActualComputingPower(minerProject.getComputingPower());
}
```

#### 2. åŠ¨æ€è¡¥å¿ç®—åŠ›è®¡ç®—æ–¹æ³•
```java
private BigDecimal calculateDynamicCompensationPower(MinerProject minerProject, Long purchaseTime) {
    // èŽ·å–çŸ¿æœºåˆ›å»ºæ—¶é—´
    Long minerCreateTime = minerProject.getCreateTime();
    if (minerCreateTime == null) {
        return new BigDecimal(minerProject.getComputingPower());
    }
    
    // è®¡ç®—å¤©æ•°å·®
    long daysDifference = calculateDaysDifference(minerCreateTime, purchaseTime);
    
    // ä»Žç¬¬äºŒå¤©å¼€å§‹è¡¥å¿ï¼Œå³ n >= 2
    if (daysDifference < 2) {
        return new BigDecimal(minerProject.getComputingPower());
    }
    
    // è®¡ç®—è¡¥å¿å€æ•°ï¼š1.003^(n-1)
    BigDecimal baseMultiplier = new BigDecimal("1.003");
    int exponent = (int) (daysDifference - 1); // n-1
    BigDecimal compensationMultiplier = baseMultiplier.pow(exponent);
    
    // è®¡ç®—è¡¥å¿ç®—åŠ›
    BigDecimal originalPower = new BigDecimal(minerProject.getComputingPower());
    BigDecimal actualPower = originalPower.multiply(compensationMultiplier);
    
    return actualPower;
}
```

#### 3. å¤©æ•°å·®è®¡ç®—æ–¹æ³•
```java
private long calculateDaysDifference(Long startTime, Long endTime) {
    // å°†æ—¶é—´æˆ³è½¬æ¢ä¸ºLocalDate
    LocalDate startDate = LocalDateTime.ofInstant(
        java.time.Instant.ofEpochMilli(startTime), 
        ZoneId.systemDefault()
    ).toLocalDate();
    
    LocalDate endDate = LocalDateTime.ofInstant(
        java.time.Instant.ofEpochMilli(endTime), 
        ZoneId.systemDefault()
    ).toLocalDate();
    
    // è®¡ç®—å¤©æ•°å·®
    return java.time.temporal.ChronoUnit.DAYS.between(startDate, endDate);
}
```

## ðŸ“Š **è®¡ç®—ç¤ºä¾‹**

### **è¡¥å¿ç®—åŠ›è®¡ç®—è¡¨**

| å¤©æ•°å·®(n) | è¡¥å¿å€æ•°(1.003^(n-1)) | åŽŸå§‹ç®—åŠ›1000 | å®žé™…ç®—åŠ› |
|-----------|----------------------|-------------|----------|
| 1å¤©       | 1.000                | 1000        | 1000     |
| 2å¤©       | 1.003                | 1000        | 1003     |
| 3å¤©       | 1.006009             | 1000        | 1006.009 |
| 7å¤©       | 1.018108             | 1000        | 1018.108 |
| 30å¤©      | 1.094174             | 1000        | 1094.174 |
| 90å¤©      | 1.300270             | 1000        | 1300.270 |
| 365å¤©     | 2.997260             | 1000        | 2997.260 |

### **å®žé™…åœºæ™¯ç¤ºä¾‹**

```
çŸ¿æœºé¡¹ç›®Aï¼š
- åˆ›å»ºæ—¶é—´ï¼š2024-01-01 00:00:00
- è´­ä¹°æ—¶é—´ï¼š2024-01-05 10:30:00
- å¤©æ•°å·®ï¼š4å¤©
- è¡¥å¿å€æ•°ï¼š1.003^(4-1) = 1.003^3 = 1.009027
- åŽŸå§‹ç®—åŠ›ï¼š1000
- å®žé™…ç®—åŠ›ï¼š1000 Ã— 1.009027 = 1009.027

çŸ¿æœºé¡¹ç›®Bï¼š
- åˆ›å»ºæ—¶é—´ï¼š2024-01-01 00:00:00
- è´­ä¹°æ—¶é—´ï¼š2024-01-01 15:30:00
- å¤©æ•°å·®ï¼š0å¤©ï¼ˆå½“å¤©è´­ä¹°ï¼‰
- è¡¥å¿å€æ•°ï¼šæ— è¡¥å¿
- åŽŸå§‹ç®—åŠ›ï¼š1000
- å®žé™…ç®—åŠ›ï¼š1000ï¼ˆæ— è¡¥å¿ï¼‰
```

## ðŸ”„ **ä¿®æ”¹å‰åŽå¯¹æ¯”**

| ç‰¹æ€§ | ä¿®æ”¹å‰ | ä¿®æ”¹åŽ |
|------|--------|--------|
| **è®¡ç®—æ–¹å¼** | å›ºå®šå€æ•° | åŠ¨æ€è®¡ç®— 1.003^(n-1) |
| **æ—¶é—´å› ç´ ** | ä¸è€ƒè™‘ | è€ƒè™‘çŸ¿æœºåˆ›å»ºåˆ°è´­ä¹°çš„æ—¶é—´é—´éš” |
| **è¡¥å¿è§„åˆ™** | ç«‹å³ç”Ÿæ•ˆ | ä»Žç¬¬äºŒå¤©å¼€å§‹è¡¥å¿ |
| **é…ç½®ä¾èµ–** | ä¾èµ–ç³»ç»Ÿé…ç½® | æ— éœ€é¢å¤–é…ç½® |
| **è®¡ç®—ç²¾åº¦** | å›ºå®š | åŸºäºŽå®žé™…å¤©æ•°å·® |

## ðŸš€ **æ ¸å¿ƒä¼˜åŠ¿**

1. **æ—¶é—´ä»·å€¼ä½“çŽ°**ï¼šè¶Šæ™šè´­ä¹°ï¼Œè¡¥å¿è¶Šå¤šï¼Œä½“çŽ°æ—¶é—´ä»·å€¼
2. **åŠ¨æ€è°ƒæ•´**ï¼šæ ¹æ®å®žé™…æ—¶é—´é—´éš”è‡ªåŠ¨è®¡ç®—è¡¥å¿
3. **ç²¾ç¡®è®¡ç®—**ï¼šä½¿ç”¨BigDecimalç¡®ä¿è®¡ç®—ç²¾åº¦
4. **æ—¥å¿—è®°å½•**ï¼šè¯¦ç»†è®°å½•è®¡ç®—è¿‡ç¨‹ï¼Œä¾¿äºŽè°ƒè¯•
5. **å¼‚å¸¸å¤„ç†**ï¼šè®¡ç®—å¤±è´¥æ—¶å›žé€€åˆ°åŽŸå§‹ç®—åŠ›

## ðŸ“ **æŠ€æœ¯ç»†èŠ‚**

### **å¹‚è¿ç®—å®žçŽ°**
```java
// ä½¿ç”¨BigDecimal.pow()è¿›è¡Œç²¾ç¡®çš„å¹‚è¿ç®—
BigDecimal baseMultiplier = new BigDecimal("1.003");
int exponent = (int) (daysDifference - 1);
BigDecimal compensationMultiplier = baseMultiplier.pow(exponent);
```

### **æ—¶é—´è®¡ç®—**
```java
// ä½¿ç”¨ChronoUnit.DAYSç²¾ç¡®è®¡ç®—å¤©æ•°å·®
return java.time.temporal.ChronoUnit.DAYS.between(startDate, endDate);
```

### **æ—¥å¿—è®°å½•**
```java
log.info("çŸ¿æœº{}åŠ¨æ€è¡¥å¿è®¡ç®—: åˆ›å»ºæ—¶é—´={}, è´­ä¹°æ—¶é—´={}, å¤©æ•°å·®={}, è¡¥å¿å€æ•°={}, åŽŸå§‹ç®—åŠ›={}, å®žé™…ç®—åŠ›={}", 
        minerProject.getId(), 
        new java.util.Date(minerCreateTime), 
        new java.util.Date(purchaseTime), 
        daysDifference, 
        compensationMultiplier, 
        originalPower, 
        actualPower);
```

## âœ… **éªŒè¯è¦ç‚¹**

1. **å½“å¤©è´­ä¹°**ï¼šæ— è¡¥å¿ï¼Œä½¿ç”¨åŽŸå§‹ç®—åŠ›
2. **ç¬¬äºŒå¤©è´­ä¹°**ï¼šè¡¥å¿å€æ•° = 1.003
3. **é•¿æœŸè´­ä¹°**ï¼šè¡¥å¿å€æ•°æŒ‰æŒ‡æ•°å¢žé•¿
4. **å¼‚å¸¸å¤„ç†**ï¼šçŸ¿æœºåˆ›å»ºæ—¶é—´ä¸ºç©ºæ—¶ä½¿ç”¨åŽŸå§‹ç®—åŠ›
5. **ç²¾åº¦ä¿è¯**ï¼šä½¿ç”¨BigDecimalé¿å…æµ®ç‚¹æ•°ç²¾åº¦é—®é¢˜

## ðŸŽ¯ **ä¸šåŠ¡å½±å“**

- **ç”¨æˆ·æ¿€åŠ±**ï¼šé¼“åŠ±ç”¨æˆ·å°½æ—©è´­ä¹°çŸ¿æœº
- **æ—¶é—´ä»·å€¼**ï¼šä½“çŽ°çŸ¿æœºé¡¹ç›®çš„æ—¶é—´ä»·å€¼
- **å…¬å¹³æ€§**ï¼šæ ¹æ®å®žé™…ç­‰å¾…æ—¶é—´ç»™äºˆç›¸åº”è¡¥å¿
- **å¯æ‰©å±•æ€§**ï¼šè¡¥å¿è§„åˆ™å¯æ ¹æ®ä¸šåŠ¡éœ€æ±‚è°ƒæ•´

ä¿®æ”¹å®Œæˆï¼çŽ°åœ¨çŸ¿æœºè´­ä¹°æ—¶çš„è¡¥å¿ç®—åŠ›å°†æ ¹æ®çŸ¿æœºåˆ›å»ºæ—¶é—´åˆ°è´­ä¹°æ—¶é—´çš„å¤©æ•°å·®åŠ¨æ€è®¡ç®—ï¼Œä½¿ç”¨1.003çš„n-1æ¬¡æ–¹å…¬å¼ã€‚
