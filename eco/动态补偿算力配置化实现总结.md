# åŠ¨æ€è¡¥å¿ç®—åŠ›é…ç½®åŒ–å®ç°æ€»ç»“

## ğŸ“Š **éœ€æ±‚æ›´æ–°**

æ ¹æ®ç”¨æˆ·åé¦ˆï¼Œä¿®æ”¹è¡¥å¿ç®—åŠ›è®¡ç®—é€»è¾‘ï¼š
1. **å€æ•°é…ç½®**ï¼šä»æ•°æ®åº“ `INCREASE_MULTIPLIER` é…ç½®è·å–ï¼ˆè€Œä¸æ˜¯ç¡¬ç¼–ç 1.003ï¼‰
2. **æœ‰æ•ˆæœŸé…ç½®**ï¼šä»æ•°æ®åº“ `EFFECTIVE_DAY` é…ç½®è·å–
3. **ç”Ÿæ•ˆæ—¶é—´**ï¼šä»è´­ä¹°æ—¶å°±å¼€å§‹è¡¥å¿ï¼ˆè€Œä¸æ˜¯ä»ç¬¬äºŒå¤©å¼€å§‹ï¼‰

## ğŸ”§ **ä¿®æ”¹å†…å®¹**

### **1. ä¸»è®¡ç®—é€»è¾‘æ›´æ–°**

```java
// è®¡ç®—åŠ¨æ€è¡¥å¿ç®—åŠ› - ä»æ•°æ®åº“è·å–å€æ•°é…ç½®ï¼Œä½¿ç”¨baseMultiplier^(n-1)å…¬å¼
BigDecimal actualComputingPower = calculateDynamicCompensationPower(minerProject, purchaseMinerProject.getCreateTime());

if (actualComputingPower.compareTo(new BigDecimal(minerProject.getComputingPower())) > 0) {
    // è®¾ç½®è¡¥å¿ç®—åŠ›
    purchaseMinerProject.setActualComputingPower(actualComputingPower.toString());
    
    // è®¾ç½®åŠ é€Ÿåˆ°æœŸæ—¶é—´ï¼ˆä»è´­ä¹°æ—¶å¼€å§‹ï¼Œæœ‰æ•ˆæœŸä»é…ç½®è·å–ï¼‰
    Long effectiveTime = calculateEffectiveTime();
    purchaseMinerProject.setAccelerateExpireTime(effectiveTime);
} else {
    // å¦‚æœæ²¡æœ‰è¡¥å¿ï¼Œä½¿ç”¨åŸå§‹ç®—åŠ›
    purchaseMinerProject.setActualComputingPower(minerProject.getComputingPower());
}
```

### **2. åŠ¨æ€è¡¥å¿ç®—åŠ›è®¡ç®—æ–¹æ³•**

```java
private BigDecimal calculateDynamicCompensationPower(MinerProject minerProject, Long purchaseTime) {
    // ä»æ•°æ®åº“è·å–å€æ•°é…ç½®
    LambdaQueryWrapper<SystemConfig> increaseQueryWrapper = new LambdaQueryWrapper<>();
    increaseQueryWrapper.eq(SystemConfig::getName, SystemConfigEnum.INCREASE_MULTIPLIER.getCode());
    SystemConfig increaseSystemConfig = systemConfigMapper.selectOne(increaseQueryWrapper);
    
    if (increaseSystemConfig == null || increaseSystemConfig.getValue() == null) {
        return new BigDecimal(minerProject.getComputingPower());
    }
    
    BigDecimal baseMultiplier = new BigDecimal(increaseSystemConfig.getValue());
    
    // è®¡ç®—å¤©æ•°å·®
    long daysDifference = calculateDaysDifference(minerCreateTime, purchaseTime);
    
    // ä»è´­ä¹°æ—¶å¼€å§‹è¡¥å¿ï¼Œå³ n >= 1
    if (daysDifference < 1) {
        return new BigDecimal(minerProject.getComputingPower());
    }
    
    // è®¡ç®—è¡¥å¿å€æ•°ï¼šbaseMultiplier^(n-1)
    int exponent = (int) (daysDifference - 1); // n-1
    BigDecimal compensationMultiplier = baseMultiplier.pow(exponent);
    
    // è®¡ç®—è¡¥å¿ç®—åŠ›
    BigDecimal originalPower = new BigDecimal(minerProject.getComputingPower());
    BigDecimal actualPower = originalPower.multiply(compensationMultiplier);
    
    return actualPower;
}
```

### **3. æœ‰æ•ˆæœŸè®¡ç®—æ–¹æ³•**

```java
private Long calculateEffectiveTime() {
    // ä»æ•°æ®åº“è·å–æœ‰æ•ˆæœŸé…ç½®
    LambdaQueryWrapper<SystemConfig> effectiveQueryWrapper = new LambdaQueryWrapper<>();
    effectiveQueryWrapper.eq(SystemConfig::getName, SystemConfigEnum.EFFECTIVE_DAY.getCode());
    SystemConfig effectiveSystemConfig = systemConfigMapper.selectOne(effectiveQueryWrapper);
    
    if (effectiveSystemConfig == null || effectiveSystemConfig.getValue() == null) {
        // å¦‚æœæ²¡æœ‰é…ç½®ï¼Œé»˜è®¤1å¤©æœ‰æ•ˆæœŸ
        LocalDateTime effectiveDate = LocalDateTime.now().plusDays(1);
        return effectiveDate.atZone(ZoneId.systemDefault()).toInstant().toEpochMilli();
    }
    
    // ä»è´­ä¹°æ—¶å¼€å§‹ï¼ŒåŠ ä¸Šé…ç½®çš„æœ‰æ•ˆå¤©æ•°
    long effectiveDays = Long.parseLong(effectiveSystemConfig.getValue());
    LocalDateTime effectiveDate = LocalDateTime.now().plusDays(effectiveDays);
    return effectiveDate.atZone(ZoneId.systemDefault()).toInstant().toEpochMilli();
}
```

## ğŸ“Š **é…ç½®è¯´æ˜**

### **æ•°æ®åº“é…ç½®è¡¨ (system_config)**

| é…ç½®åç§° | é…ç½®å€¼ | è¯´æ˜ | ç¤ºä¾‹ |
|----------|--------|------|------|
| `INCREASE_MULTIPLIER` | åŸºç¡€å€æ•° | è¡¥å¿ç®—åŠ›çš„åŸºç¡€å€æ•° | `1.003` |
| `EFFECTIVE_DAY` | æœ‰æ•ˆå¤©æ•° | è¡¥å¿ç®—åŠ›çš„æœ‰æ•ˆå¤©æ•° | `30` |

### **è®¡ç®—ç¤ºä¾‹**

å‡è®¾é…ç½®ï¼š
- `INCREASE_MULTIPLIER` = `1.003`
- `EFFECTIVE_DAY` = `30`

çŸ¿æœºé¡¹ç›®Aï¼š
- åˆ›å»ºæ—¶é—´ï¼š2024-01-01 00:00:00
- è´­ä¹°æ—¶é—´ï¼š2024-01-05 10:30:00
- å¤©æ•°å·®ï¼š4å¤©
- è¡¥å¿å€æ•°ï¼š1.003^(4-1) = 1.003^3 = 1.009027
- åŸå§‹ç®—åŠ›ï¼š1000
- å®é™…ç®—åŠ›ï¼š1000 Ã— 1.009027 = 1009.027
- æœ‰æ•ˆæœŸï¼šè´­ä¹°æ—¶å¼€å§‹ï¼Œ30å¤©ååˆ°æœŸ

## ğŸ”„ **ä¿®æ”¹å‰åå¯¹æ¯”**

| ç‰¹æ€§ | ä¿®æ”¹å‰ | ä¿®æ”¹å |
|------|--------|--------|
| **å€æ•°æ¥æº** | ç¡¬ç¼–ç 1.003 | æ•°æ®åº“é…ç½® `INCREASE_MULTIPLIER` |
| **æœ‰æ•ˆæœŸæ¥æº** | ç¡¬ç¼–ç 1å¤© | æ•°æ®åº“é…ç½® `EFFECTIVE_DAY` |
| **ç”Ÿæ•ˆæ—¶é—´** | ç¬¬äºŒå¤©å¼€å§‹ | è´­ä¹°æ—¶å¼€å§‹ |
| **è¡¥å¿æ¡ä»¶** | n >= 2 | n >= 1 |
| **é…ç½®çµæ´»æ€§** | æ—  | å®Œå…¨å¯é…ç½® |

## ğŸ“Š **è¡¥å¿ç®—åŠ›è®¡ç®—è¡¨**

å‡è®¾ `INCREASE_MULTIPLIER` = `1.003`ï¼š

| å¤©æ•°å·®(n) | è¡¥å¿å€æ•°(1.003^(n-1)) | åŸå§‹ç®—åŠ›1000 | å®é™…ç®—åŠ› |
|-----------|----------------------|-------------|----------|
| 0å¤©       | 1.000                | 1000        | 1000     |
| 1å¤©       | 1.003                | 1000        | 1003     |
| 2å¤©       | 1.006009             | 1000        | 1006.009 |
| 7å¤©       | 1.018108             | 1000        | 1018.108 |
| 30å¤©      | 1.094174             | 1000        | 1094.174 |
| 90å¤©      | 1.300270             | 1000        | 1300.270 |
| 365å¤©     | 2.997260             | 1000        | 2997.260 |

## âœ… **æ ¸å¿ƒä¼˜åŠ¿**

1. **é…ç½®åŒ–**ï¼šå€æ•°å’Œæœ‰æ•ˆæœŸå®Œå…¨å¯é…ç½®ï¼Œæ— éœ€ä¿®æ”¹ä»£ç 
2. **çµæ´»æ€§**ï¼šå¯ä»¥æ ¹æ®ä¸šåŠ¡éœ€æ±‚è°ƒæ•´è¡¥å¿ç­–ç•¥
3. **å³æ—¶ç”Ÿæ•ˆ**ï¼šä»è´­ä¹°æ—¶å°±å¼€å§‹è¡¥å¿ï¼Œç”¨æˆ·ä½“éªŒæ›´å¥½
4. **ç²¾ç¡®è®¡ç®—**ï¼šä½¿ç”¨BigDecimalç¡®ä¿è®¡ç®—ç²¾åº¦
5. **å¼‚å¸¸å¤„ç†**ï¼šé…ç½®ç¼ºå¤±æ—¶æœ‰åˆç†çš„é»˜è®¤å€¼

## ğŸš€ **ä½¿ç”¨æ–¹å¼**

### **é…ç½®è®¾ç½®**
```sql
-- è®¾ç½®è¡¥å¿å€æ•°
INSERT INTO system_config (name, value, description) 
VALUES ('INCREASE_MULTIPLIER', '1.003', 'çŸ¿æœºå¢åŠ å€æ•°');

-- è®¾ç½®æœ‰æ•ˆæœŸ
INSERT INTO system_config (name, value, description) 
VALUES ('EFFECTIVE_DAY', '30', 'å¢åŠ å€æ•°æœ‰æ•ˆå¤©æ•°');
```

### **ä¸šåŠ¡é€»è¾‘**
- çŸ¿æœºè´­ä¹°æ—¶è‡ªåŠ¨è®¡ç®—åŠ¨æ€è¡¥å¿ç®—åŠ›
- è¡¥å¿ç®—åŠ›ç«‹å³ç”Ÿæ•ˆ
- æœ‰æ•ˆæœŸä»è´­ä¹°æ—¶å¼€å§‹è®¡ç®—
- åˆ°æœŸåæ¢å¤åŸå§‹ç®—åŠ›

## ğŸ“ **æŠ€æœ¯ç»†èŠ‚**

### **é…ç½®è·å–**
```java
// è·å–å€æ•°é…ç½®
SystemConfig increaseSystemConfig = systemConfigMapper.selectOne(
    new LambdaQueryWrapper<SystemConfig>()
        .eq(SystemConfig::getName, SystemConfigEnum.INCREASE_MULTIPLIER.getCode())
);

// è·å–æœ‰æ•ˆæœŸé…ç½®
SystemConfig effectiveSystemConfig = systemConfigMapper.selectOne(
    new LambdaQueryWrapper<SystemConfig>()
        .eq(SystemConfig::getName, SystemConfigEnum.EFFECTIVE_DAY.getCode())
);
```

### **å¹‚è¿ç®—å®ç°**
```java
// ä½¿ç”¨BigDecimal.pow()è¿›è¡Œç²¾ç¡®çš„å¹‚è¿ç®—
BigDecimal baseMultiplier = new BigDecimal(increaseSystemConfig.getValue());
int exponent = (int) (daysDifference - 1);
BigDecimal compensationMultiplier = baseMultiplier.pow(exponent);
```

### **æ—¶é—´è®¡ç®—**
```java
// ä»è´­ä¹°æ—¶å¼€å§‹è®¡ç®—æœ‰æ•ˆæœŸ
LocalDateTime effectiveDate = LocalDateTime.now().plusDays(effectiveDays);
Long effectiveTime = effectiveDate.atZone(ZoneId.systemDefault()).toInstant().toEpochMilli();
```

## ğŸ¯ **ä¸šåŠ¡å½±å“**

- **ç”¨æˆ·ä½“éªŒ**ï¼šè¡¥å¿ç®—åŠ›ç«‹å³ç”Ÿæ•ˆï¼Œç”¨æˆ·æ„Ÿå—æ›´å¥½
- **é…ç½®ç®¡ç†**ï¼šç®¡ç†å‘˜å¯ä»¥é€šè¿‡æ•°æ®åº“é…ç½®è°ƒæ•´è¡¥å¿ç­–ç•¥
- **ä¸šåŠ¡çµæ´»æ€§**ï¼šå¯ä»¥æ ¹æ®å¸‚åœºæƒ…å†µè°ƒæ•´å€æ•°å’Œæœ‰æ•ˆæœŸ
- **ç³»ç»Ÿç¨³å®šæ€§**ï¼šé…ç½®ç¼ºå¤±æ—¶æœ‰åˆç†çš„é»˜è®¤è¡Œä¸º

ä¿®æ”¹å®Œæˆï¼ç°åœ¨è¡¥å¿ç®—åŠ›è®¡ç®—å®Œå…¨åŸºäºæ•°æ®åº“é…ç½®ï¼Œä»è´­ä¹°æ—¶å°±å¼€å§‹ç”Ÿæ•ˆï¼Œæä¾›äº†æ›´å¥½çš„çµæ´»æ€§å’Œç”¨æˆ·ä½“éªŒã€‚
