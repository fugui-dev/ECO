# é—æ¼ä¿®æ”¹æ¸…å•

## ğŸ” **å…¨é¡¹ç›®æ£€æŸ¥ç»“æœ**

ç»è¿‡å…¨é¢æ£€æŸ¥ï¼Œå‘ç°ä»¥ä¸‹é—æ¼çš„ä¿®æ”¹ï¼š

### âœ… **å·²å®Œæˆçš„ä¿®æ”¹**
1. **RewardConstructor.java** - æ€»ç®—åŠ›è®¡ç®—
2. **PurchaseMinerProjectServiceImpl.java** - çŸ¿æœºè´­ä¹°ç®—åŠ›ç»Ÿè®¡
3. **RecommendServiceImpl.java** - æ¨èå…³ç³»ç®—åŠ›ç»Ÿè®¡
4. **PurchaseMinerProjectScheduled.java** - å®šæ—¶ä»»åŠ¡ç®—åŠ›æ›´æ–°

### âŒ **é—æ¼çš„ä¿®æ”¹**

#### 1. **RewardConstructor.java** - åŠ¨æ€å¥–åŠ±æ–¹æ³•
**é—®é¢˜ï¼š** åŠ¨æ€å¥–åŠ±æ–¹æ³•è¿˜åœ¨ä½¿ç”¨ `RecommendStatisticsLogDTO`ï¼Œéœ€è¦æ”¹ä¸ºä½¿ç”¨ `ComputingPowerDTO`

**éœ€è¦ä¿®æ”¹çš„æ–¹æ³•ï¼š**
- `recommendReward()` - åŠ¨æ€æ¨èå¥–åŠ±
- `baseReward()` - åŠ¨æ€å°åŒºå¥–åŠ±  
- `newReward()` - åŠ¨æ€æ–°å¢å¥–åŠ±

**ä¿®æ”¹å†…å®¹ï¼š**
```java
// åŸæ–¹æ³•ç­¾å
public SingleResponse<Void> recommendReward(BigDecimal dynamicTotalReward,
                                            List<RecommendStatisticsLogDTO> recommendStatisticsLogList,
                                            String dayTime,
                                            List<PurchaseMinerProjectReward> rewardList)

// æ–°æ–¹æ³•ç­¾å
public SingleResponse<Void> recommendReward(BigDecimal dynamicTotalReward,
                                            List<ComputingPowerDTO> computingPowerList,
                                            String dayTime,
                                            List<PurchaseMinerProjectReward> rewardList)
```

#### 2. **æ§åˆ¶å™¨å±‚** - ç”¨æˆ·æŸ¥è¯¢æ¥å£
**æ–‡ä»¶ï¼š**
- `RecommendStatisticsLogController.java`
- `AdminRecommendStatisticsLogController.java`

**é—®é¢˜ï¼š** è¿˜åœ¨ä½¿ç”¨ `RecommendStatisticsLogService`ï¼Œéœ€è¦æ”¹ä¸ºä½¿ç”¨ `ComputingPowerService`

**ä¿®æ”¹å†…å®¹ï¼š**
```java
@Resource
private ComputingPowerService computingPowerService;

@PostMapping("/info")
SingleResponse<RecommendStatisticsLogDTO> get(@RequestBody RecommendStatisticsLogQry recommendStatisticsLogQry) {
    String dayTime = recommendStatisticsLogQry.getDayTime();
    if (dayTime == null || dayTime.trim().isEmpty()) {
        dayTime = LocalDate.now().format(DateTimeFormatter.ofPattern("yyyy-MM-dd"));
    }
    
    SingleResponse<ComputingPowerDTO> response = computingPowerService.getComputingPowerInfo(
        recommendStatisticsLogQry.getWalletAddress(), dayTime);
    
    if (response.isSuccess()) {
        RecommendStatisticsLogDTO dto = convertToOldFormat(response.getData());
        return SingleResponse.of(dto);
    }
    
    return SingleResponse.buildFailure(response.getErrMessage());
}
```

#### 3. **ä¾èµ–æ³¨å…¥** - ç¼ºå°‘å¿…è¦çš„æœåŠ¡æ³¨å…¥
**éœ€è¦æ·»åŠ çš„ä¾èµ–ï¼š**
```java
@Resource
private ComputingPowerService computingPowerService;

@Resource
private ComputingPowerServiceImplV2 computingPowerServiceV2;
```

**éœ€è¦æ·»åŠ ä¾èµ–çš„æ–‡ä»¶ï¼š**
- `RewardConstructor.java`
- `PurchaseMinerProjectServiceImpl.java`
- `RecommendServiceImpl.java`
- `PurchaseMinerProjectScheduled.java`
- `RecommendStatisticsLogController.java`
- `AdminRecommendStatisticsLogController.java`

#### 4. **ç¼“å­˜æ¸…é™¤** - å¯ç”¨ç¼“å­˜æ¸…é™¤åŠŸèƒ½
**éœ€è¦å–æ¶ˆæ³¨é‡Šçš„ä»£ç ï¼š**
```java
// åœ¨ä»¥ä¸‹æ–‡ä»¶ä¸­å–æ¶ˆæ³¨é‡Š
computingPowerServiceV2.invalidateUserCache(walletAddress);
```

**æ–‡ä»¶ä½ç½®ï¼š**
- `PurchaseMinerProjectServiceImpl.java` ç¬¬282è¡Œ
- `RecommendServiceImpl.java` ç¬¬166è¡Œ
- `PurchaseMinerProjectScheduled.java` ç¬¬60è¡Œå’Œç¬¬115è¡Œ
- `RewardConstructor.java` ç¬¬1354è¡Œ

#### 5. **å¯¼å…¥è¯­å¥** - æ·»åŠ å¿…è¦çš„å¯¼å…¥
**éœ€è¦æ·»åŠ çš„å¯¼å…¥ï¼š**
```java
import com.example.eco.bean.dto.ComputingPowerDTO;
import com.example.eco.core.service.ComputingPowerService;
import com.example.eco.core.service.impl.ComputingPowerServiceImplV2;
import com.example.eco.util.ComputingPowerUtil;
```

## ğŸš€ **ä¿®æ”¹ä¼˜å…ˆçº§**

### **é«˜ä¼˜å…ˆçº§ï¼ˆå¿…é¡»ä¿®æ”¹ï¼‰**
1. **RewardConstructor.java** - åŠ¨æ€å¥–åŠ±æ–¹æ³•
2. **ä¾èµ–æ³¨å…¥** - æ·»åŠ å¿…è¦çš„æœåŠ¡æ³¨å…¥
3. **ç¼“å­˜æ¸…é™¤** - å¯ç”¨ç¼“å­˜æ¸…é™¤åŠŸèƒ½

### **ä¸­ä¼˜å…ˆçº§ï¼ˆå»ºè®®ä¿®æ”¹ï¼‰**
1. **æ§åˆ¶å™¨å±‚** - ç”¨æˆ·æŸ¥è¯¢æ¥å£
2. **å¯¼å…¥è¯­å¥** - æ·»åŠ å¿…è¦çš„å¯¼å…¥

### **ä½ä¼˜å…ˆçº§ï¼ˆå¯é€‰ä¿®æ”¹ï¼‰**
1. **æ¸…ç†ä»£ç ** - åˆ é™¤ä¸å†ä½¿ç”¨çš„ `RecommendStatisticsLogService` ç›¸å…³ä»£ç 

## ğŸ“‹ **ä¿®æ”¹æ£€æŸ¥æ¸…å•**

- [ ] RewardConstructor.java - åŠ¨æ€å¥–åŠ±æ–¹æ³•ç­¾åå’Œå®ç°
- [ ] RewardConstructor.java - æ·»åŠ ä¾èµ–æ³¨å…¥
- [ ] PurchaseMinerProjectServiceImpl.java - æ·»åŠ ä¾èµ–æ³¨å…¥
- [ ] RecommendServiceImpl.java - æ·»åŠ ä¾èµ–æ³¨å…¥
- [ ] PurchaseMinerProjectScheduled.java - æ·»åŠ ä¾èµ–æ³¨å…¥
- [ ] RecommendStatisticsLogController.java - ä¿®æ”¹æŸ¥è¯¢æ¥å£
- [ ] AdminRecommendStatisticsLogController.java - ä¿®æ”¹æŸ¥è¯¢æ¥å£
- [ ] æ‰€æœ‰æ–‡ä»¶ - å¯ç”¨ç¼“å­˜æ¸…é™¤åŠŸèƒ½
- [ ] æ‰€æœ‰æ–‡ä»¶ - æ·»åŠ å¿…è¦çš„å¯¼å…¥è¯­å¥
- [ ] æµ‹è¯•éªŒè¯ - ç¡®ä¿ä¿®æ”¹ååŠŸèƒ½æ­£å¸¸

## âš ï¸ **æ³¨æ„äº‹é¡¹**

1. **æ•°æ®ä¸€è‡´æ€§** - ä¿®æ”¹åéœ€è¦éªŒè¯ç®—åŠ›è®¡ç®—ç»“æœçš„å‡†ç¡®æ€§
2. **æ€§èƒ½å½±å“** - æ–°æœåŠ¡ä½¿ç”¨ç¼“å­˜ï¼Œé¦–æ¬¡æŸ¥è¯¢å¯èƒ½è¾ƒæ…¢
3. **å‘åå…¼å®¹** - æ§åˆ¶å™¨å±‚éœ€è¦ä¿æŒAPIå…¼å®¹æ€§
4. **é”™è¯¯å¤„ç†** - ç¡®ä¿æ‰€æœ‰å¼‚å¸¸æƒ…å†µéƒ½æœ‰é€‚å½“çš„å¤„ç†
5. **æ—¥å¿—è®°å½•** - ä¿æŒè¯¦ç»†çš„æ—¥å¿—è®°å½•ä»¥ä¾¿è°ƒè¯•

## ğŸ”§ **å¿«é€Ÿä¿®å¤å‘½ä»¤**

```bash
# 1. æ·»åŠ ä¾èµ–æ³¨å…¥åˆ°æ‰€æœ‰ç›¸å…³æ–‡ä»¶
# 2. ä¿®æ”¹RewardConstructorä¸­çš„åŠ¨æ€å¥–åŠ±æ–¹æ³•
# 3. ä¿®æ”¹æ§åˆ¶å™¨å±‚æŸ¥è¯¢æ¥å£
# 4. å¯ç”¨ç¼“å­˜æ¸…é™¤åŠŸèƒ½
# 5. æ·»åŠ å¿…è¦çš„å¯¼å…¥è¯­å¥
```

å®Œæˆè¿™äº›ä¿®æ”¹åï¼Œæ•´ä¸ªç®—åŠ›ç³»ç»Ÿå°†å®Œå…¨è¿ç§»åˆ°æ–°çš„ `ComputingPowerService`ï¼Œå®ç°æ›´å‡†ç¡®ã€æ›´å®æ—¶çš„ç®—åŠ›è®¡ç®—ã€‚